{
  "identity": {
    "id": "atr",
    "label": "ATR (Average True Range)",
    "category": "Volatility",
    "tier": "CORE",
    "tags": ["Volatility", "Risk Sizing", "Breakout Filter", "Trend Confirmation"]
  },
  "docs": {
    "blurb": "Average True Range (ATR) measures market volatility by averaging True Range over a lookback window.",
    "longSummary": "ATR quantifies how much price typically moves per bar by averaging the True Range, which captures gaps and intrabar extremes. Rising ATR often accompanies breakouts and trending phases, while falling ATR suggests compressions or ranges. Traders use ATR for position sizing, ATR-multiple stops, and as a volatility filter to time entries. Combining ATR with a trend indicator (e.g., EMA) can help focus on expansions aligned with the prevailing direction.",
    "mathSummary": "True Range = max(high−low, |high−prevClose|, |low−prevClose|); ATRₙ = Wilder’s moving average of True Range over n bars.",
    "references": [
      {
        "label": "Investopedia — Average True Range (ATR)",
        "url": "https://www.investopedia.com/terms/a/atr.asp"
      }
    ]
  },
  "params": [
    {
      "key": "length",
      "label": "ATR Length",
      "type": "integer",
      "default": 14,
      "min": 2,
      "max": 500,
      "step": 1,
      "unit": "bars"
    },
    {
      "key": "smoothing",
      "label": "Smoothing Method",
      "type": "enum",
      "options": ["wilder", "ema", "sma"],
      "default": "wilder"
    },
    {
      "key": "source",
      "label": "Price Source",
      "type": "enum",
      "options": ["hlc3", "close", "ohlc4"],
      "default": "hlc3"
    }
  ],
  "outputs": ["atr", "trueRange"],
  "supportedOperators": [">", ">=", "<", "<=", "==", "crosses_above", "crosses_below", "rising", "falling", "within", "outside"],
  "signals": [
    {
      "id": "vol_expansion",
      "label": "Volatility Expansion",
      "when": [
        { "left": "atr", "op": "rising", "right": null }
      ]
    },
    {
      "id": "vol_contraction",
      "label": "Volatility Contraction",
      "when": [
        { "left": "atr", "op": "falling", "right": null }
      ]
    }
  ],
  "ui": {
    "tooltips": {
      "_indicator": "ATR averages True Range to describe typical bar movement (volatility).",
      "length": "Lookback window for averaging True Range. Longer = smoother.",
      "smoothing": "Averaging method for ATR (Wilder, EMA, or SMA).",
      "source": "Price composite used for True Range when relevant."
    }
  },
  "constraints": {
    "recommendedTimeframes": ["15m", "1h", "4h", "1D"],
    "notes": "ATR scales with price volatility; consider adaptive stops/sizing on faster charts."
  },
  "examples": [
    { "name": "ATR 14 Expansion + EMA50 Trend", "presetRef": "atr_normal_expansion_14" },
    { "name": "ATR 14↔50 Relative Vol Filter", "presetRef": "atr_normal_relfilter_14_50" },
    { "name": "ATR 21 Contraction Breakout Watch", "presetRef": "atr_normal_contraction_21" },
    { "name": "ATR Hero: Breakout + RSI Confirm", "presetRef": "atr_hero_breakout_rsi" },
    { "name": "ATR Hero: Trend Momentum + Priority", "presetRef": "atr_hero_trend_priority" },
    { "name": "ATR Hero: MTF Vol Align + Window", "presetRef": "atr_hero_mtf_window" }
  ],
  "riskTemplates": {
    "atrStop": {
      "enabledDefault": false,
      "tooltip": "Places stop a multiple of ATR from entry.",
      "params": { "atrPeriod": 14, "atrMult": 1.5 }
    },
    "trailingTP": {
      "enabledDefault": false,
      "tooltip": "Locks in profits with a trailing take-profit.",
      "params": { "type": "percent", "percent": 0.8 }
    },
    "breakeven": {
      "enabledDefault": false,
      "tooltip": "Moves stop to entry after a defined unrealized gain.",
      "params": { "triggerPercent": 1.0, "offsetPercent": 0.05 }
    },
    "timeStop": {
      "enabledDefault": false,
      "tooltip": "Exits after a fixed number of bars.",
      "params": { "maxBars": 120 }
    }
  },
  "presets": [
    {
      "id": "atr_normal_expansion_14",
      "name": "ATR 14 Expansion + EMA50 Trend",
      "presetTier": "Normal",
      "riskProfile": "Balanced",
      "designIntent": "Momentum",
      "extras": [],
      "indicators": [
        { "id": "atr", "params": { "length": 14, "smoothing": "wilder", "source": "hlc3" } },
        { "id": "ema", "params": { "length": 50, "source": "close" } }
      ],
      "entry": {
        "long": [
          { "left": "atr", "op": "rising", "right": null },
          { "left": "price", "op": ">", "right": "ema" }
        ],
        "short": [
          { "left": "atr", "op": "rising", "right": null },
          { "left": "price", "op": "<", "right": "ema" }
        ]
      },
      "exit": {
        "long": [
          { "left": "atr", "op": "falling", "right": null }
        ],
        "short": [
          { "left": "atr", "op": "falling", "right": null }
        ]
      },
      "riskDefaults": {}
    },
    {
      "id": "atr_normal_relfilter_14_50",
      "name": "ATR 14↔50 Relative Vol Filter",
      "presetTier": "Normal",
      "riskProfile": "Conservative",
      "designIntent": "Filter",
      "extras": [],
      "indicators": [
        { "id": "atr", "params": { "length": 14, "smoothing": "wilder", "source": "hlc3" } },
        { "id": "atr", "params": { "length": 50, "smoothing": "wilder", "source": "hlc3" } }
      ],
      "entry": {
        "long": [
          { "left": "atr[14]", "op": ">", "right": "atr[50]" }
        ],
        "short": [
          { "left": "atr[14]", "op": "<", "right": "atr[50]" }
        ]
      },
      "exit": {
        "long": [
          { "left": "atr[14]", "op": "<=", "right": "atr[50]" }
        ],
        "short": [
          { "left": "atr[14]", "op": ">=", "right": "atr[50]" }
        ]
      },
      "riskDefaults": {}
    },
    {
      "id": "atr_normal_contraction_21",
      "name": "ATR 21 Contraction Breakout Watch",
      "presetTier": "Normal",
      "riskProfile": "Aggressive",
      "designIntent": "Breakout",
      "extras": [],
      "indicators": [
        { "id": "atr", "params": { "length": 21, "smoothing": "ema", "source": "hlc3" } },
        { "id": "sma", "params": { "length": 50, "source": "close" } }
      ],
      "entry": {
        "long": [
          { "left": "atr", "op": "falling", "right": null },
          { "left": "price", "op": "crosses_above", "right": "sma" }
        ],
        "short": [
          { "left": "atr", "op": "falling", "right": null },
          { "left": "price", "op": "crosses_below", "right": "sma" }
        ]
      },
      "exit": {
        "long": [
          { "left": "atr", "op": "rising", "right": null }
        ],
        "short": [
          { "left": "atr", "op": "rising", "right": null }
        ]
      },
      "riskDefaults": {}
    },
    {
      "id": "atr_hero_breakout_rsi",
      "name": "ATR Hero: Breakout + RSI Confirm",
      "presetTier": "Hero",
      "riskProfile": "Balanced",
      "designIntent": "Breakout",
      "extras": ["confirmationIndicator", "signalCooldown"],
      "indicators": [
        { "id": "atr", "params": { "length": 14, "smoothing": "wilder", "source": "hlc3" } },
        { "id": "rsi", "params": { "length": 14, "source": "close", "upper": 70, "lower": 30, "middle": 50, "smooth": true } }
      ],
      "extrasConfig": {
        "confirmationIndicator": {
          "id": "rsi",
          "mode": "momentumAboveMid",
          "rule": { "left": "rsi", "op": ">", "right": 50 }
        },
        "signalCooldown": { "bars": 12 }
      },
      "entry": {
        "long": [
          { "left": "atr", "op": "rising", "right": null },
          { "left": "rsi", "op": ">", "right": 50 }
        ],
        "short": [
          { "left": "atr", "op": "rising", "right": null },
          { "left": "rsi", "op": "<", "right": 50 }
        ]
      },
      "exit": {
        "long": [
          { "left": "atr", "op": "falling", "right": null }
        ],
        "short": [
          { "left": "atr", "op": "falling", "right": null }
        ]
      },
      "riskDefaults": {
        "atrStop": { "enabledDefault": false, "params": { "atrPeriod": 14, "atrMult": 1.8 } },
        "trailingTP": { "enabledDefault": false, "params": { "type": "percent", "percent": 1.0 } },
        "breakeven": { "enabledDefault": false, "params": { "triggerPercent": 1.2, "offsetPercent": 0.05 } },
        "timeStop": { "enabledDefault": false, "params": { "maxBars": 96 } }
      }
    },
    {
      "id": "atr_hero_trend_priority",
      "name": "ATR Hero: Trend Momentum + Priority",
      "presetTier": "Hero",
      "riskProfile": "Aggressive",
      "designIntent": "Momentum",
      "extras": ["priority", "riskGuard"],
      "indicators": [
        { "id": "atr", "params": { "length": 10, "smoothing": "ema", "source": "hlc3" } },
        { "id": "ema", "params": { "length": 50, "source": "close" } },
        { "id": "ema", "params": { "length": 200, "source": "close" } }
      ],
      "extrasConfig": {
        "priority": { "tier": 2 },
        "riskGuard": { "maxOpenPositions": 6, "dailyMaxDrawdownPct": 6.0 }
      },
      "entry": {
        "long": [
          { "left": "atr", "op": "rising", "right": null },
          { "left": "ema[50]", "op": ">", "right": "ema[200]" },
          { "left": "price", "op": ">", "right": "ema[50]" }
        ],
        "short": [
          { "left": "atr", "op": "rising", "right": null },
          { "left": "ema[50]", "op": "<", "right": "ema[200]" },
          { "left": "price", "op": "<", "right": "ema[50]" }
        ]
      },
      "exit": {
        "long": [
          { "left": "atr", "op": "falling", "right": null }
        ],
        "short": [
          { "left": "atr", "op": "falling", "right": null }
        ]
      },
      "riskDefaults": {
        "atrStop": { "enabledDefault": false, "params": { "atrPeriod": 10, "atrMult": 2.0 } },
        "trailingTP": { "enabledDefault": false, "params": { "type": "percent", "percent": 1.2 } },
        "timeStop": { "enabledDefault": false, "params": { "maxBars": 72 } }
      }
    },
    {
      "id": "atr_hero_mtf_window",
      "name": "ATR Hero: MTF Vol Align + Window",
      "presetTier": "Hero",
      "riskProfile": "Conservative",
      "designIntent": "Filter",
      "extras": ["multiTFConfirm", "timeWindow"],
      "indicators": [
        { "id": "atr", "params": { "length": 14, "smoothing": "wilder", "source": "hlc3" } }
      ],
      "extrasConfig": {
        "multiTFConfirm": {
          "higherTF": "4h",
          "rule": { "left": "atr", "op": "rising", "right": null }
        },
        "timeWindow": { "session": "Any", "active": true }
      },
      "entry": {
        "long": [
          { "left": "atr", "op": "rising", "right": null }
        ],
        "short": [
          { "left": "atr", "op": "rising", "right": null }
        ]
      },
      "exit": {
        "long": [
          { "left": "atr", "op": "falling", "right": null }
        ],
        "short": [
          { "left": "atr", "op": "falling", "right": null }
        ]
      },
      "riskDefaults": {
        "atrStop": { "enabledDefault": false, "params": { "atrPeriod": 14, "atrMult": 1.6 } },
        "breakeven": { "enabledDefault": false, "params": { "triggerPercent": 0.9, "offsetPercent": 0.03 } },
        "timeStop": { "enabledDefault": false, "params": { "maxBars": 144 } }
      }
    }
  ],
  "deprecated": false
}
