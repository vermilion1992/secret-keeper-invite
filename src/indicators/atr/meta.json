{
  "schemaVersion": "1.0",
  "version": "1",
  "id": "atr",
  "label": "ATR",
  "category": "Volatility",
  "tier": "CORE",
  "tags": ["Volatility", "Risk", "Range"],
  "blurb": "Average True Range (ATR) measures market volatility as the average of true ranges over N periods.",
  "longSummary": "ATR captures how much price typically moves per bar by averaging the True Range (max of high−low, |high−prevClose|, |low−prevClose|). It does not indicate direction; it quantifies volatility for filters, sizing, and dynamic stops. Many traders normalize ATR by price to compare across assets. Common uses include identifying expansions/contractions, gating breakouts during high volatility, and scaling stop-loss distances.",
  "mathSummary": "ATR_t = MA_N( TR_t ), where TR_t = max( high−low, |high−close_{t−1}|, |low−close_{t−1}| ). Wilder smoothing is commonly used.",
  "references": [
    "https://www.investopedia.com/terms/a/atr.asp"
  ],
  "params": {
    "length": { "type": "int", "default": 14, "min": 2, "max": 200, "step": 1, "unit": "bars" },
    "smoothing": { "type": "enum", "default": "wilder", "options": ["wilder", "ema"], "unit": "" },
    "outputMode": { "type": "enum", "default": "percent", "options": ["raw", "percent"], "unit": "mode" },
    "percentScale": { "type": "float", "default": 100.0, "min": 1.0, "max": 100.0, "step": 1.0, "unit": "× (for percent output)" }
  },
  "outputs": ["value"],
  "supportedOperators": [
    ">",
    ">=",
    "<",
    "<=",
    "==",
    "crosses_above",
    "crosses_below",
    "rising",
    "falling",
    "within",
    "outside"
  ],
  "signals": {
    "bullish": [
      { "name": "ATR expansion", "left": "atr.value", "op": "rising", "lookback": 3 }
    ],
    "bearish": [
      { "name": "ATR contraction", "left": "atr.value", "op": "falling", "lookback": 3 }
    ]
  },
  "ui": {
    "tooltips": {
      "_indicator": "Average True Range (ATR) quantifies volatility; higher = wider ranges.",
      "length": "Periods used to average true range. Higher = smoother.",
      "smoothing": "Wilder (classic) or EMA-style averaging.",
      "outputMode": "Raw ATR units or percent of price (ATR/Close × percentScale).",
      "percentScale": "Multiplier when outputMode=percent (e.g., 100 → percent)."
    },
    "badges": ["Volatility"]
  },
  "constraints": {
    "recommendedTimeframes": ["5m", "15m", "1h"]
  },
  "examples": [
    { "name": "ATR Expansion (Normal)", "presetRef": "atr_expansion_normal" },
    { "name": "ATR Contraction (Normal)", "presetRef": "atr_contraction_normal" },
    { "name": "ATR Rising Streak (Normal)", "presetRef": "atr_rising_streak_normal" },
    { "name": "ATR Trend Break (Hero)", "presetRef": "atr_trend_break_hero" },
    { "name": "ATR Squeeze Release (Hero)", "presetRef": "atr_squeeze_release_hero" },
    { "name": "ATR Session Momentum (Hero)", "presetRef": "atr_session_momentum_hero" }
  ],
  "riskTemplates": {
    "atrStop": {
      "enabledDefault": false,
      "params": { "atrLength": 14, "mult": 2.0 },
      "tooltip": "Protective stop at ATR × multiple; adapts to volatility."
    },
    "trailingTP": {
      "enabledDefault": false,
      "params": { "trailPct": 0.7, "activationR": 1.0 },
      "tooltip": "Trail profit once trade reaches a threshold."
    },
    "breakeven": {
      "enabledDefault": false,
      "params": { "activationR": 1.0 },
      "tooltip": "Move stop to entry after reaching +R."
    },
    "timeStop": {
      "enabledDefault": false,
      "params": { "bars": 30 },
      "tooltip": "Exit after a maximum number of bars."
    }
  },
  "presets": [
    {
      "id": "atr_expansion_normal",
      "label": "ATR Expansion (Normal)",
      "blurb": "Enter only when volatility exceeds a minimal threshold.",
      "indicators": ["atr"],
      "seedParams": {
        "atr": { "length": 14, "smoothing": "wilder", "outputMode": "percent", "percentScale": 100.0 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "atr.value", "op": ">", "right": 0.7 }
        ]
      },
      "riskDefaults": {},
      "badges": ["Volatility", "Filter"]
    },
    {
      "id": "atr_contraction_normal",
      "label": "ATR Contraction (Normal)",
      "blurb": "Gate entries during quiet conditions (low ATR).",
      "indicators": ["atr"],
      "seedParams": {
        "atr": { "length": 14, "smoothing": "wilder", "outputMode": "percent", "percentScale": 100.0 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "atr.value", "op": "<", "right": 0.3 }
        ]
      },
      "riskDefaults": {},
      "badges": ["Volatility", "Conservative"]
    },
    {
      "id": "atr_rising_streak_normal",
      "label": "ATR Rising Streak (Normal)",
      "blurb": "Require a short rising streak in ATR before enabling entries.",
      "indicators": ["atr"],
      "seedParams": {
        "atr": { "length": 14, "smoothing": "wilder", "outputMode": "percent", "percentScale": 100.0 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "atr.value", "op": "rising", "lookback": 3 }
        ]
      },
      "riskDefaults": {},
      "badges": ["Volatility", "Expansion"]
    },
    {
      "id": "atr_trend_break_hero",
      "label": "ATR Trend Break (Hero)",
      "blurb": "Volatility expansion with trend regime and breakout confirmation.",
      "indicators": ["atr", "ema", "donchian_channels"],
      "seedParams": {
        "atr": { "length": 14, "smoothing": "wilder", "outputMode": "percent", "percentScale": 100.0 },
        "ema": { "period": 200, "source": "close", "offset": 0 },
        "donchian_channels": { "period": 20 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "close", "op": ">", "right": "ema.value" },
          { "left": "atr.value", "op": ">", "right": 0.6 },
          { "left": "close", "op": ">", "right": "donchian_channels.upper" }
        ]
      },
      "riskDefaults": {
        "atrStop": { "params": { "atrLength": 14, "mult": 2.0 } },
        "trailingTP": { "params": { "trailPct": 0.6, "activationR": 1.0 } }
      },
      "badges": ["Hero", "Regime", "Breakout"]
    },
    {
      "id": "atr_squeeze_release_hero",
      "label": "ATR Squeeze Release (Hero)",
      "blurb": "Low-volatility squeeze followed by ATR pop; cooldown to avoid noise.",
      "indicators": ["atr", "bollinger_bandwidth"],
      "seedParams": {
        "atr": { "length": 14, "smoothing": "wilder", "outputMode": "percent", "percentScale": 100.0 },
        "bollinger_bandwidth": { "period": 20 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "bollinger_bandwidth.value", "op": "<", "right": 6.0 },
          { "left": "atr.value", "op": "crosses_above", "right": 0.5 },
          { "left": "signalCooldown.bars", "op": ">=", "right": 10 }
        ]
      },
      "riskDefaults": {
        "atrStop": { "params": { "atrLength": 14, "mult": 1.8 } },
        "timeStop": { "params": { "bars": 40 } }
      },
      "badges": ["Hero", "Squeeze", "Cooldown"]
    },
    {
      "id": "atr_session_momentum_hero",
      "label": "ATR Session Momentum (Hero)",
      "blurb": "Trade only during a configured session window with ATR expansion and long bias.",
      "indicators": ["atr"],
      "seedParams": {
        "atr": { "length": 14, "smoothing": "wilder", "outputMode": "percent", "percentScale": 100.0 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "sessionFilter.window", "op": "within", "right": ["09:00", "17:00"] },
          { "left": "directionBias", "op": "==", "right": "long" },
          { "left": "atr.value", "op": ">", "right": 0.5 }
        ]
      },
      "riskDefaults": {
        "atrStop": { "params": { "atrLength": 14, "mult": 2.2 } },
        "breakeven": { "params": { "activationR": 1.0 } }
      },
      "badges": ["Hero", "Session", "Momentum"]
    }
  ],
  "deprecated": false
}
