{
  "schemaVersion": "1.0",
  "version": "1",
  "id": "ema",
  "label": "EMA",
  "category": "Trend",
  "tier": "CORE",
  "tags": ["Trend", "Moving Average"],

  "blurb": "Exponential moving average that weights recent prices more heavily to track trend with less lag than SMA.",
  "longSummary": "The Exponential Moving Average (EMA) smooths price by applying a higher weight to recent observations, reacting faster to trend changes than a simple moving average. Traders often use a long EMA (e.g., 200) as a regime filter to distinguish bullish versus bearish conditions, and shorter EMAs for entries. As a dynamic support/resistance, EMA retests and reclaims are frequent entry cues. Combine with a momentum filter (e.g., RSI) and volatility-aware risk controls to reduce whipsaw.",
  "mathSummary": "EMA_t = α·Price_t + (1−α)·EMA_{t−1}, where α = 2/(N+1) and N is the period length.",
  "references": [
    "https://www.investopedia.com/terms/e/ema.asp"
  ],

  "params": {
    "period":  { "type": "int",  "default": 200, "min": 2,  "max": 500, "step": 1, "unit": "bars" },
    "source":  { "type": "enum", "default": "close", "options": ["close", "open", "high", "low"] },
    "offset":  { "type": "int",  "default": 0,   "min": -50, "max": 50,  "step": 1, "unit": "bars" }
  },

  "outputs": ["value"],

  "supportedOperators": [
    ">", ">=", "<", "<=", "==",
    "crosses_above", "crosses_below",
    "rising", "falling",
    "within", "outside"
  ],

  "signals": {
    "bullish": [
      { "name": "Price crosses above EMA", "left": "close", "op": "crosses_above", "right": "ema.value" }
    ],
    "bearish": [
      { "name": "Price crosses below EMA", "left": "close", "op": "crosses_below", "right": "ema.value" }
    ]
  },

  "ui": {
    "tooltips": {
      "_indicator": "EMA weights recent prices more; faster than SMA to reflect trend shifts.",
      "period": "Higher = smoother, slower; common filters: 50 (swing), 200 (regime).",
      "source": "Price field to average.",
      "offset": "Shifts the EMA for visualization; does not change the underlying calculation."
    },
    "badges": ["Trend"]
  },

  "constraints": {
    "recommendedTimeframes": ["15m", "1h", "4h"]
  },

  "examples": [
    { "name": "EMA Trend Pullback", "presetRef": "ema_trend_pullback" },
    { "name": "EMA + RSI Trend Filter", "presetRef": "ema_rsi_trend_filter" },
    { "name": "EMA Retest Continuation", "presetRef": "ema_retest_continuation" },
    { "name": "EMA Slope Momentum", "presetRef": "ema_slope_momentum" }
  ],

  "riskTemplates": {
    "atrStop": {
      "enabledDefault": false,
      "params": { "atrLength": 14, "mult": 2.0 },
      "tooltip": "ATR-scaled protective stop; widens in high volatility and tightens when quiet."
    },
    "trailingTP": {
      "enabledDefault": false,
      "params": { "trailPct": 0.7, "activationR": 1.0 },
      "tooltip": "Trailing take-profit to lock gains once the trade moves in your favor."
    },
    "breakeven": {
      "enabledDefault": false,
      "params": { "activationR": 1.0 },
      "tooltip": "Move stop to entry price after reaching the activation R multiple."
    },
    "timeStop": {
      "enabledDefault": false,
      "params": { "bars": 30 },
      "tooltip": "Exit after a maximum number of bars if neither SL nor TP is hit."
    }
  },

  "presets": [
    {
      "id": "ema_trend_pullback",
      "label": "EMA Trend Pullback",
      "blurb": "Buy the reclaim above a long EMA after a brief dip.",
      "indicators": ["ema", "atr"],
      "seedParams": {
        "ema": { "period": 200 },
        "atr": { "length": 14 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "close", "op": "<", "right": "ema.value", "lookback": 3, "mode": "consecutive" },
          { "left": "close", "op": "crosses_above", "right": "ema.value" },
          { "left": "ema.value", "op": "rising", "right": null, "optional": true }
        ]
      },
      "riskDefaults": {
        "atrStop":    { "params": { "atrLength": 14, "mult": 2.0 } },
        "trailingTP": { "params": { "trailPct": 0.6, "activationR": 1.0 } },
        "breakeven":  { "params": { "activationR": 1.0 } }
      },
      "badges": ["Trend", "Reclaim"]
    },
    {
      "id": "ema_rsi_trend_filter",
      "label": "EMA + RSI Trend Filter",
      "blurb": "Trade with the EMA trend only when RSI confirms momentum.",
      "indicators": ["ema", "rsi", "atr"],
      "seedParams": {
        "ema": { "period": 200 },
        "rsi": { "length": 14 },
        "atr": { "length": 14 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "close", "op": ">", "right": "ema.value" },
          { "left": "rsi.value", "op": ">", "right": 55 }
        ]
      },
      "riskDefaults": {
        "atrStop":    { "params": { "atrLength": 14, "mult": 1.9 } },
        "trailingTP": { "params": { "trailPct": 0.7, "activationR": 1.0 } }
      },
      "badges": ["Trend", "Momentum"]
    },
    {
      "id": "ema_retest_continuation",
      "label": "EMA Retest Continuation",
      "blurb": "Enter on first bullish close after an EMA retest from above.",
      "indicators": ["ema", "atr"],
      "seedParams": {
        "ema": { "period": 100 },
        "atr": { "length": 14 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "close", "op": "<", "right": "ema.value", "lookback": 3 },
          { "left": "close", "op": ">", "right": "ema.value" }
        ]
      },
      "riskDefaults": {
        "atrStop":  { "params": { "atrLength": 14, "mult": 2.1 } },
        "timeStop": { "params": { "bars": 30 } }
      },
      "badges": ["Trend", "Pullback"]
    },
    {
      "id": "ema_slope_momentum",
      "label": "EMA Slope Momentum",
      "blurb": "Trade in the direction of a rising EMA with a momentum confirm.",
      "indicators": ["ema", "rsi", "atr"],
      "seedParams": {
        "ema": { "period": 100 },
        "rsi": { "length": 14 },
        "atr": { "length": 14 }
      },
      "rules": {
        "joiner": "AND",
        "rules": [
          { "left": "ema.value", "op": "rising", "right": null },
          { "left": "close", "op": ">", "right": "ema.value" },
          { "left": "rsi.value", "op": ">", "right": 50, "optional": true }
        ]
      },
      "riskDefaults": {
        "atrStop":    { "params": { "atrLength": 14, "mult": 2.0 } },
        "trailingTP": { "params": { "trailPct": 0.6, "activationR": 1.0 } },
        "breakeven":  { "params": { "activationR": 1.0 } }
      },
      "badges": ["Trend", "Momentum"]
    }
  ],

  "deprecated": false
}
